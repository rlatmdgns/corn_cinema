<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace ="com.acorn.mapper.MemberMapper">
  
  	   
  <!--ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ  CRUD  ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ-->
 	
  
	   
	 <!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡinsert Memberㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ  -->
	  <insert id="insertMember"  parameterType="com.acorn.domain.MemberVo">
	     insert into corn_movie.tbl_member (
	       id, password, name, email
	     ) values(
	      #{id}, #{password}, #{name},#{email}
	      )
	  </insert>
	     
    <!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡudate Memberㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ  -->    
	 <update id="updateProfile">
	    update tbl_member set
        password = #{password}, 
        updatedate = now()
        WHERE id =#{id}          
    </update>

    <!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡdelete Memberㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ  -->   

   <delete id="deleteProfile">
	   DELETE FROM tbl_member WHERE id = #{id} and password = #{password}
   </delete>
    
	<!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡlogin Checkㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ  -->
		   
	 <select id="login" resultType="com.acorn.domain.MemberVo">    <!-- resultType -> UserVO 풀패키지명 -->
  
      SELECT * FROM tbl_member WHERE id= #{id} and password = #{password}
          
     </select>	   

	 <!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ id Ckeck(id 중복검사)ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ  -->
    
     <select id= "idCheck" parameterType="string" resultType="int">
         SELECT count(*) from tbl_member where id=#{user_id}
     </select>
        
     <!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ email Ckeck(email 중복검사)ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ  -->
     
     <select id= "emailCheck" parameterType="string" resultType="int">
          SELECT count(*) from tbl_member where email=#{user_email}
     </select>
     
     <!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ reset Pw(임시 비밀번호받기위한 check)ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ  -->
     
     <select id="update_ResetPw" parameterType="string" resultType="int">
              SELECT count(*) from tbl_member where id=#{id} and email=#{email}
     </select>
     
     <!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ사용자가 로그인한시간 ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ  -->
     <update id ="loginTimeCheck">
             UPDATE tbl_member
			 SET connection_time = now()
			 where id = #{id}
     </update> 
     
      <!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ사용자가 로그아웃한 시간 ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ  -->
     <update id ="logOutTimeCkeck">
             UPDATE tbl_member
			 SET disconnected_time = now()
			 where id = #{id}
     </update>      
     
     
     
    <!-- ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ마이페이지ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ -->
 	<!-- 예매번호 출력 -->
 	
 	<select id= "showReservation"      
 	parameterType="com.acorn.domain.MypageVO">
      
 		select distinct r.reservation_num, 
 			   s.movie_start_time, 
 			   m.title,
 			   c.local_info_dist, 
 			   r.reservation_date
		from 
			   tbl_reservation r, 
			   tbl_movie m, 
			   tbl_cinema c, 
			   tbl_screening s
		
		where 
			   r.movie_num=m.movie_num and m.movie_num=s.movie_num and s.cinema_num=c.cinema_num and 
			   r.id=#{id}
		
		GROUP BY reservation_num
 	
 	</select>
     
   <delete id="deleteBooking">
      delete from tbl_reservation where reservation_num=#{reservation_num}
   </delete>
   
   <select id= "MemberBoardList"  parameterType="com.acorn.model.PageDTO" resultType="com.acorn.domain.MemberBoardVO">
       select 
             id,
             name,
             email,
             regdate,
             updatedate,  
             connection_time,  
          
       from 
         tbl_member
       where id like concat('%',#{keyword},'%')
       ORDER BY id asc
       limit #{pageStart}, 10
    </select>
     
    <select id="getMemberListCount" parameterType="com.acorn.model.PageDTO" resultType="int">
		select count(id) from tbl_member 
		where id like concat('%',#{keyword},'%')   	
    </select> 
    
    
    
    <select id = "MemberBoardOne" parameterType="String" resultType="com.acorn.domain.MemberBoardVO">
     
          select 
             id,
             name,
             email,
             regdate,
             updatedate,  
             connection_time,  
             disconnected_time            
         from 
         tbl_member 
         where id = #{member.id}
    </select>
    
    
    
    
    
    
    
    
    
  </mapper>